# Linked-Files

## Инструкция по установке
1.	Под владельцем схемы Парус-8 выполнить скрипт `Linked-Files-Script.sql`
2.	Войти в модуль **_Администратор_** под русским интерфейсом.
3.	В разделе **_Предопределенный импорт_** выполнить импорт посылки `Linked-Files.prf`, установив чеккер *Игнорировать дату редакции*
4.	В разделе **_Приложения_** для записи с кодом `Admin` выполнить действие *Редактор меню*. 
  1.	В меню *Словари* сделать активным пункт *Свойства документов* и выполнить действие *Добавить*.
В окне свойств для заголовка и подсказки задать `Присоединенные файлы`
  2.	Сделать активным добавленный пункт меню *Присоединенные файлы* и выполнить действие *Добавить подменю*
В окне свойств в поле *Код* выбрать раздел `Разделы присоединенных файлов`, в поле *Метод* выбрать метод `main`, для заголовка задать значение `Разделы`
  3.	Сделать активным добавленный пункт меню *Разделы* и выполнить действие *Добавить*
В окне свойств в поле *Код* выбрать раздел `Места хранения присоединенных файлов`, в поле *Метод* выбрать метод `main`, для заголовка задать значение `Места хранения`
  4.	Закрыть редактор меню, сохранив изменения.
5.	Войти в модуль Администратор под украинским интерфейсом.
6.	В разделе **_Визначений імпорт_** выполнить импорт посылки `Linked-Files.prf`, установив чеккер *Ігнорувати дату редакції*
7.	В разделе *Застосунки* для записи с кодом `Admin`  выполнить действие *Редактор меню*. 
  1.	В меню *Словники* сделать активным пункт *Властивості документів* и выполнить действие *Додати*.
В окне свойств для заголовка и подсказки задать `Приєднані файли`
  2.	Сделать активным добавленный пункт меню *Приєднані файли* и выполнить действие *Додати підменю*
В окне свойств в поле *Код* выбрать раздел `Розділи приєднаних файлів`, в поле *Метод* выбрать метод `main`, для заголовка задать значение `Розділи`
  3.	Сделать активным добавленный пункт меню *Розділи* и выполнить действие *Додати*
В окне свойств в поле *Код* выбрать раздел `Місця зберігання приєднаних файлів`, в поле *Метод* выбрать метод `main`, для заголовка задать значение *Місця зберігання*
  4.	Закрыть редактор меню, сохранив изменения.
8. Создать роли `Администратор мест хранения присоединенных файлов` и `Администратор присоединенных файлов`.
9. Назначить роли *Администратор мест хранения присоединенных файлов* права на приложение `Администратор`, права на необходимые организации, и права доступа к разделу `Места хранения присоединенных файлов` и его действиям.
10. Назначить роли *Администратор присоединенных файлов* права на приложение `Администратор`, права на организацию `Система` и другие необходимые организации, и права доступа к разделу `Разделы присоединенных файлов` и его действиям, а также права на просмотр в разделе `Места хранения присоединенных файлов` и разделах организации *Система*: `Разделы системы`, `Системные словари` и `Таблицы системы`.

## Руководство администратора мест хранения присоединенных файлов
### Введение
В системе может быть заведено неограниченное количество мест хранения присоединенных файлов.
В качестве места хранения присоединенных файлов может быть использована:
* удаленная директория, доступная по протоколу FTP;
* локальная директория на сервере БД;
* удаленная директория смонтированная в файловую систему сервера БД.

Присоединенные пользователями файлы будут сохраняютя в подпапках указанной в качестве места хранения директории. Первая подпапка будет создана автоматически, когда пользователь присоединит какой-либо файл. В последствие, подпапки будут автоматически создаваться, когда во всех уже существующих подпапках количество файлов достигнет, задаваемого администратором, максимального количества.

При использовании FTP-папки, администратору БД необходимо предварительно настроить разрешения сетевого доступа к FTP-серверу с помощью **_Oracle Access Control List (ACL)_** 

При использовании локальной или смонтированной локально удаленной папки, администратору БД необходимо:
* создать объект БД `DIRECTORY`, ссылающийся на папку. Например:
```sql
create or replace directory UDO_PARUS_LINKED_FILES as '/home/oracle/linkfilesstore';
```
* дать привелегии `EXECUTE`, `READ` и `WRITE` для созданного объекта пользователю БД, являющемуся владельцем схемы "Парус". Например:
```sql
grant read, write on directory UDO_PARUS_LINKED_FILES to PARUS;
```
* дать следующие Java разрешения пользователю БД, являющемуся владельцем схемы "Парус", на операции в папке операционной системы, соответствующей созданной директории. Например:
```sql
EXEC dbms_java.grant_permission( 'PARUS', 'SYS:java.io.FilePermission', '/home/oracle/linkfilesstore', 'read' );
EXEC dbms_java.grant_permission( 'PARUS', 'SYS:java.io.FilePermission', '/home/oracle/linkfilesstore/-', 'read,write,delete' );
```

### Управление местами хранения присоединенных файлов
Для управление местами хранения присоединенных файлов, в системе предназначен одноименный раздел, вызываемый из гланого меню модуля  **Администратор** `Словари->Присоединенные файлы->Места хранения`. Раздел имеет стандартный для системы "Парус-8" интерфейс. В Левой части окна разделов расположено дерево каталогов, для разграничения прав доступа и структуризации мест хранения. В верхней части окна располагается список зарегистрированных мест хранения, в нижней - список подпапок в выбранном месте хранения с указанием текущего количества файлов в кажлой из них.
![Внешний вид раздела](https://raw.github.com/igorgo/Linked-Files/master/Docs/img/UdoFileStores_View.png)

При работе со списком мест хранения администратор может выполнить следующие основные действия
* Добавить
* Исправить
* Удалить

### Добавление места хранения присоединенных файлов
На форме добавления администратор указывает произвольный уникальный мнемокод и наименование места хранения, максимальное количество файлов в подпапках, и тип места хранения. При выборе, в качестве типа, значения **_Директория Oracle_**, необходимо указать имя соответствующего объекта `DIRECTORY` в БД. 

![Пример добавления места хранения с типом _Директория Oracle_](https://raw.github.com/igorgo/Linked-Files/master/Docs/img/UdoFileStores_AddDir.png)

При выборе, в качестве типа, значения **_Папка FTP-сервера_**, на появляющейся вкладке *Параметры FTP* необходимо указать параметры FTP-соединения.

![Пример добавления места хранения с типом _Папка FTP-сервера_](https://raw.github.com/igorgo/Linked-Files/master/Docs/img/UdoFileStores_AddFTP.png)

Заметьте, что указание IP-адреса необязательно, но при непустом его значении при соединении будет использоваться именно он, а указанное в этом случае доменное имя может и не существовать.


